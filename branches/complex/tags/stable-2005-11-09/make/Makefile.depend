# $Id$

# Implicit dependencies
# Generate rules which specify source file dependencies

# If we're not doing a clean, and some source files have been found, include the autogenerated
# dependency rules for those source files. If the makefiles containing these rules cannot be found
# make will attempt to remake them.
ifneq (${MAKECMDGOALS},clean)
ifneq (${MAKECMDGOALS},uninstall)
ifneq (${strip ${CC_SRC} ${CPP_SRC} ${SWIG_SRC}},)
-include ${addprefix ${L_DEP_DIR}/, ${CC_SRC:.c=.d} ${CPP_SRC:.cpp=.d} ${SWIG_SRC:.i=.d}}
endif
endif
endif

# Rules to autogenerate dependency rules for .c files
${L_DEP_DIR}/%.d: %.c
	@echo ----------------------------------------------------------------------------
	@if test ! -e "${@D}"; then mkdir -p ${@D}; fi
	${strip ${CC} ${CC_DEP_FLAGS} ${CC_FLAGS} $<} \
		| sed 's|.*:|${strip ${patsubst ${L_SRC_DIR}/%.c, %.o, $<}} ${@}:|g' > $@
	@[ -s $@ ] || rm -f $@; [ -f $@ ]
	@echo Generated \"$@: $<\".

# Rules to autogenerate dependency rules for .cpp files
${L_DEP_DIR}/%.d: %.cpp
	@echo ----------------------------------------------------------------------------
	@if test ! -e "${@D}"; then mkdir -p ${@D}; fi
	${strip ${CPP} ${CPP_DEP_FLAGS} ${CPP_FLAGS} $<} \
		| sed 's|.*:|${strip ${patsubst ${L_SRC_DIR}/%.cpp, %.o, $<}} ${@}:|g' > $@
	@[ -s $@ ] || rm -f $@; [ -f $@ ]
	@echo Generated \"$@: $<\".

# $Log$
# Revision 1.2  2005/06/09 05:38:02  jgs
# Merge of development branch back to main trunk on 2005-06-09
#
# Revision 1.1.1.1.2.1  2005/05/18 06:38:39  jgs
# don't make dependencies on target uninstall
#
# Revision 1.1.1.1  2004/10/26 06:53:58  jgs
# initial import of project esys2
#
# Revision 1.2  2004/09/23 01:48:45  jgs
# make: augmented Makefiles with comments throughout
#
#         Makefile.default - changed order of includes for clarity
#         Makfile.phony    - reordered phony targets
#                          - added target "all" - now first target to be encountered
#
# Revision 1.1.1.1  2004/06/24 04:00:39  johng
# Initial version of eys using boost-python.
#
# Revision 1.2  2003/08/25 02:18:40  davies
# Do not build source dependencies when simply cleaning.
#
# Revision 1.1.1.1  2003/08/21 00:58:20  davies
# Imported sources from Lutz Gross.
#

