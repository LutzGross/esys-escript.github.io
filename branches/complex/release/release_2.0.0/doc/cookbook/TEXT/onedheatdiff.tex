
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%
% Copyright (c) 2003-2009 by University of Queensland
% Earth Systems Science Computational Center (ESSCC)
% http://www.uq.edu.au/esscc
%
% Primary Business: Queensland, Australia
% Licensed under the Open Software License version 3.0
% http://www.opensource.org/licenses/osl-3.0.php
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass{manual}
\title{One Dimensional Heat Equation}

\begin{document}
We will start by examining a simple one dimensional heat diffusion example. While this exact problem is not strictly relevant to earth sciences; it will provide a good launch pad to build our knowledge of escript and how to solve simple PDEs.

Start by imagining we have a simple cold iron bar at a constant temperature of zero which is perfectly insulated on either side. At one end we will apply a heating element of some description. Intuition tells us that as heat is applied, that energy will disperse through the bar with time. Essentially the heat will spread along the bar until the bar reaches the same temperature as the heat source. At this point the temperature in the bar will be constant and the same as the heat source.

We can model this problem using the one dimensional heat diffusion equation. It is defined as:
\begin{equation}
\rho c\hackscore p \frac{\partial T}{\partial t} - \kappa \frac{\partial^{2} T}{\partial x^{2}} = q\hackscore H
\label{DIFFUSION TEMP EQ 1}
\end{equation}
where $\rho c\hackscore p$ and $\kappa$ are given material constants and $q\hackscore H$ is our heat source. Equation \eqn{DIFFUSION TEMP EQ 1} contains two partial derivatives. $\frac{\partial T}{\partial t}$ describes the change in temperature with time while $\frac{\partial T}{\partial x}$ describes the spatial change to temperature. Because we only have a single dimension, our problem is thus only dependent on time and our position along the iron bar $x$ .

To solve this equation we will write a simple python script. The first step is to import the necessary libraries.
\begin{verbatim}
from esys.escript import *
from esys.escript.linearPDEs import LinearPDE
from esys.finley import Rectangle
import os
\end{verbatim}
It is generally a good idea to import all of escript, although if you know the packages you need you can specify them individually. The function \verb|LinearPDE| has been imported individually for ease of use later in the script. \verb|Rectangle| is going to be our type of domain. The \verb|os| package is needed to handle file outputs once our PDE has been solved.

Once our libraries have been imported we will assign values to our problem specific variables. In general the number of variables needed will vary between problems. These variables belong to two categories. They are either directly related to the PDE and can be used as inputs into the escript solver, or they are script variables used to control internal functions and iterations in our problem. 
For this PDE there are a number of constants which will need values. They are:
\begin{verbatim}
q    #our heat souce temperature
Tref #the starting temperature of our ironbar
rho
eta
kappa
T    #The current temperature - this is our solutions.
\end{verbatim}
To control our script we will have to specify:
\begin{verbatim}
t    #our start time, usually zero
tend #the time we want to end the simulation
h    #size of the time step

i    #our loop counter
save_path #the folder to put our outputs in, leave blank "" for script path

\end{verbatim}
The next step is to create a domain upon which we wish to solve our problem. There are many different types of domains in escript. We will use many variations in later tutorials but for our Iron rod we will simply use a rectangular domain. This can be thought of as the lengthways cross section of our rod. We do not need to model the volume of the rod because a cylinder is symmetrical about its center. There are four arguments we must consider when we decide to create a rectangular domain. These arguments are:
\begin{verbatim}
lenbr     # length of the bar
widbr     # the width/diameter of the bar
xstep     # the number of discrete spatial steps along x direction
ystep     # the number of discrete spatial steps along y direction
\end{verbatim}
When defining the size of our problem it will help us determine appropriate values for our domain arguments. If we make our dimensions large but our step sizes very small we will to a point, increase the accuracy of our solution. Unfortunately we also increase the number of calculations that must be calculated per time step. This means more computational time is required to produce a solution.
In our \textit{1D} problem we will define our bar as being 1 metre long. An appropriate \verb|xstep| would be 1 to 10\% of the length. Our \verb|ystep| need only be 1. This is because our problem stipulates no partial derivatives in the y direction. This means our temperature does not vary in the y direction.
Now that we know our inputs we will define our domain as:
\begin{verbatim}
 rod = Rectangle(l0=lenbr,l1=widbr,n0=xstep,n1=ystep)
\end{verbatim}
Escript offers an easy way to extract our finite points from the domain \verb|rod| this is the property \verb|getX()| . If we let \verb|x| be these finite points, then:
\begin{verbatim}
 x = rod.getX()
\end{verbatim}
With a domain and all our required variables established, it is now possible to set up our PDE so that it can be solved by escript. The first step is define the type of PDE that we are trying to solve. In this example it is a Linear PDE and we can define it by:
\begin{verbatim}
 mypde=LinearPDE(rod)
\end{verbatim}
Because we have a symmetrical problem we will also need to set the symmetry on by:
\begin{verbatim}
 myPDE.setSymmetryOn()
\end{verbatim}
The final step is to apply our PDE to the general form of a linear PDE as described in the escript manual. The general form equation is:
\begin{equation}\label{LINEARPDE.SINGLE.1}
-(A\hackscore{jl} u\hackscore{,l})\hackscore{,j}-(B\hackscore{j} u)\hackscore{,j}+C\hackscore{l} u\hackscore{,l}+D u =-X\hackscore{j,j}+Y \; .
\end{equation}

NEED TO WORK ON THIS SECTION

We now need to specify Our boundary conditions and initial values. The initial values required to solve this PDE are temperatures for each discrete point in our domain that we wish to solve for. We will set our bar to:
\begin{verbatim}
 T = Tref
\end{verbatim}
Boundary conditions are a little more difficult. Fortunately the escript solver will handle our insulated boundary conditions. However, we will need to apply our heat source $q_{H}$ to the end of the bar at $x=0$ . escript makes this easy by letting us define areas in our domain. To retrieve all the finite points in our domain we will use 

END WORK ON THIS SECTION

The final stage to our problem is exporting the data we have generated and turn our data and visualisation. It is best to export the calculated solutions at each time increment. escript has the inbuilt function \verb|saveVTK()| which makes this step very easy. saveVTK takes two arguments, the path and the filename. We are goind to use the \verb|os.path.join| command to join a subdirectory which must already exist with a file name. The string opperator \verb|%| allows us to increment our file names with the value \verb|i|. In substring \verb %03d  does a number of things; 
\begin{itemize}
 \item \verb 0  becomes the padding number;
 \item \verb 3  tells us the number of padding numbers that are required; and
 \item \verb d  indicates the end of the \verb %  operator.
\end{itemize}
To increment a \verb %i is required directly after the operation the string is involed in. The second arugment of the \verb saveVTK function is the \verb sol=T where \verb T is the solution of our PDE for a given time steo. Thus the export command becomes:
\begin{verbatim}
 saveVTK(os.path.join(save_path,"data%03d.xml") %i,sol=T)
\end{verbatim}
Visualisation is then implemented through \verb mayavi  which provides a command line of gui interface to develop plots to suit our output data. For this example a surface plot is appropriate.
\end{document}
